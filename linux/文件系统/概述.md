**linux文件系统架构图**

![example](picture/1.png)
# 用户空间
*应用程序可以直接使用内核提供的系统调用访问文件：*

* 一个存储设备上的文件系统，只有挂载到内存中目录树的某个目录下，进程才能访问这个文件系统。系统调用mount用来把文件系统挂载到内存中目录树的某个目录下。可以执行：`mount -t fstype device dir`,把文件系统挂载到某个目录下，mount命令调用系统调用mount来挂载文件系统。
* 系统调用umount用来卸载某个目录下挂载的文件系统，可以执行`umount dir`来卸载文件系统，umount调用系统调用umount
* 使用open打开文件
* 使用close关闭文件
* 使用read读文件
* 使用write写文件
* 使用lseek设置文件偏移
* 当我们写文件时，内核的文件系统模块把数据保存在页缓存中，不会立即写到存储设备，我们可以使用fsync把文件修改过的属性和数据立即写到存储设备，或者使用fdatasync把文件修改过的数据立即写到存储设备上。应用程序页可以使用glibc库封装的标准I/O流函数访问文件，标准I/O流提供了缓冲区，目的是尽可能减少read/write的调用次数，提高性能。
* glibc库封装的标准I/O流函数：
    * fopen：打开流
    * fclose：关闭流
    * fread：读流
    * fwrite：写流
    * fseek：设置文件偏移
    * 使用fwrite可以把数据写到用户空间缓存区，但是不会立即写到内核。我们可以使用fflush立即把数据立即从用户空间缓存区写到内核中。

# 硬件